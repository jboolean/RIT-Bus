// This file has been autogenerated from parsing an Objective-C header file added in Xcode.
using System;

using MonoTouch.Foundation;
using MonoTouch.UIKit;

using System.Timers;

namespace RITNow
{
	public partial class BusCellView2 : UITableViewCell
	{
		private ArrivalBundle _myArrivalBundle;

		public BusCellView2 (IntPtr handle) : base (handle)
		{
			NSTimer.CreateRepeatingScheduledTimer (TimeSpan.FromSeconds (5), repaint);
		}

		/// <summary>
		/// Change the run and destination that this cell displayson. must be in run
		/// </param>
		public ArrivalBundle ArrivalBundle {
			get {
				return _myArrivalBundle;
			}
			set {
				_myArrivalBundle = value;
				repaint ();
			}
		}

		private void repaint ()
		{
			if (_myArrivalBundle==null)
				return;
			//the big clock for the next arrival
			{
				this.destLabel.Text = _myArrivalBundle.CommonDestination;
				int minsUntil = ((int)_myArrivalBundle.Times [0].Subtract (DateTime.Now).TotalMinutes);
				if (minsUntil < 1) {
					clockLabel.Text = "DUE";
					this.minutesLabel.Hidden = true;
				} else if (minsUntil < 60) {
					clockLabel.Text = minsUntil.ToString ();
					this.minutesLabel.Hidden = false;
					this.minutesLabel.Text = "minutes";
				} else {
					clockLabel.Text = _myArrivalBundle.Times [0].ToString ("h:mm");
					this.minutesLabel.Hidden = false;
					this.minutesLabel.Text = _myArrivalBundle.Times [0].ToString ("tt");
				}
			}

			this.signalImage.Hidden = !_myArrivalBundle.Live;

			//the next times label
			{

				string nextText = "";
				//each arrival time, comma separated
				foreach (DateTime time in _myArrivalBundle.Times) {
					string thisTimeText;
					int minsUntil = ((int)time.Subtract (DateTime.Now).TotalMinutes);
					if (minsUntil < 1) {
						thisTimeText = "DUE";
					} else if (minsUntil < 60) {
						thisTimeText = minsUntil.ToString ();
					} else {
						thisTimeText = time.ToString ("h:mm tt");
					}

					nextText+=((nextText!="")?", ":"")+thisTimeText;
				}
				nextLabel.Text=nextText;
			}
		}

		public override void LayoutSubviews ()
		{
			this.clockLabel.Font = UIFont.FromName ("Citaro Voor (Dubbele hoogte, breed)", 85);
			this.minutesLabel.Font = UIFont.FromName ("dotspecial", 8);
			applyGlow (this.clockLabel);
			applyGlow (this.minutesLabel);
		}

		private void applyGlow (UIView view)
		{
			view.Layer.ShadowColor = (new UIColor ((float)254 / 255, (float)99 / 255, (float)33 / 255, 1.0f)).CGColor;
			view.Layer.ShadowRadius = 3.0f;
			view.Layer.ShadowOpacity = 0.78f;
			view.Layer.ShadowOffset = new System.Drawing.SizeF (0.0f, 0.0f);
			view.Layer.MasksToBounds = false;
		}

	}
}
